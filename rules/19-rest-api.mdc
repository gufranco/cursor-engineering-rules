---
description: REST API design standards
globs: "**/api/**/*.ts"
alwaysApply: false
---

# REST API Standards

## URL Design
```
GET    /api/v1/{resource}           # List with pagination
POST   /api/v1/{resource}           # Create
GET    /api/v1/{resource}/{id}      # Get single
PATCH  /api/v1/{resource}/{id}      # Partial update
DELETE /api/v1/{resource}/{id}      # Delete
```

## HTTP Status Codes (Strict)

| Code | When to Use |
|------|-------------|
| 200 | Success (GET, PATCH) |
| 201 | Resource created (POST) |
| 204 | Success, no content (DELETE) |
| 400 | Invalid request body |
| 401 | Missing/invalid authentication |
| 403 | Authenticated but not authorized |
| 404 | Resource not found |
| 409 | Conflict (duplicate, etc.) |
| 422 | Validation failed |
| 429 | Rate limit exceeded |
| 500 | Server error (never expose details) |

## Request Requirements

Every request MUST have:
- `Authorization: Bearer {token}` (except public endpoints)
- `Content-Type: application/json` (for POST/PATCH)

## Response Format

### Success
```json
{
  "data": { ... },
  "meta": {
    "requestId": "req_abc123",
    "timestamp": "2024-01-01T00:00:00Z"
  }
}
```

### Success with Pagination
```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "pageSize": 25,
    "totalItems": 150,
    "totalPages": 6
  },
  "meta": { ... }
}
```

### Error
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Human readable message",
    "details": [
      { "field": "email", "code": "INVALID", "message": "..." }
    ],
    "requestId": "req_abc123",
    "timestamp": "2024-01-01T00:00:00Z"
  }
}
```

## Response Headers (Required)

```typescript
response.headers.set('X-Request-ID', requestId);
response.headers.set('X-RateLimit-Limit', limit);
response.headers.set('X-RateLimit-Remaining', remaining);
response.headers.set('X-RateLimit-Reset', resetTimestamp);
```

## Pagination Parameters

```
?page=1&pageSize=25&sort=createdAt&order=desc
```

- Default pageSize: 25
- Max pageSize: 100
- Default sort: createdAt
- Default order: desc

## Filtering

```
?status=active&search=keyword&createdAfter=2024-01-01
```

All filters are AND conditions.

## Idempotency

POST requests SHOULD support `X-Idempotency-Key` header for safe retries.

## Versioning

- Version in URL path: `/api/v1/`
- Breaking changes require new version
- Old versions deprecated, not removed immediately
