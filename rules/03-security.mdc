---
description: Security best practices
alwaysApply: true
---

# Security

## NEVER Commit
`.env`, `*.pem`, `*.key`, `credentials.json`, `id_rsa`

## Input Validation
1. Type → 2. Format → 3. Range → 4. Sanitize → 5. Business rules

## Auth Checklist
- [ ] Passwords hashed (bcrypt/argon2)
- [ ] Rate limiting on auth
- [ ] Token expiration
- [ ] Permission check every request

## Common Vulnerabilities
| Issue | Prevention |
|-------|------------|
| SQL Injection | Use ORM (Prisma) |
| XSS | Use React (auto-escapes) |
| IDOR | Verify ownership on every request |

## Security Headers
```
Content-Security-Policy: default-src 'self'
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
Strict-Transport-Security: max-age=31536000
```

## Rate Limiting
- Auth endpoints: 5 requests/minute per IP
- API endpoints: 100 requests/minute per user
- Use sliding window algorithm

## Audit Logging
Log sensitive actions with context:
- Login attempts (success/failure)
- Password changes
- Role changes
- Record deletions
- Permission changes

Format: `{ action, userId, targetId, timestamp, ip, userAgent }`

## Error Messages
| Environment | Detail Level |
|-------------|--------------|
| Development | Full stack trace, debug info |
| Production | Generic message, no internals |

**Never** expose database errors, file paths, or stack traces in production.
